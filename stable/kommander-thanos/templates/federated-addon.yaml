apiVersion: types.kubefed.io/v1beta1
kind: FederatedAddon
metadata:
  name: {{ include "kommander-thanos.short-name-prefix" . }}-proxy
  namespace: {{ .Values.federate.systemNamespace.name }}
  labels:
{{ include "kommander-thanos.labels" . | indent 4 }}
spec:
  placement:
    clusterSelector:
      matchLabels: {}
  template:
    metadata:
      namespace: kubeaddons
      labels:
        kubeaddons.mesosphere.io/name: {{ include "kommander-thanos.short-name-prefix" . }}-proxy
    spec:
      namespace: {{ .Values.federate.systemNamespace.name }} 
      chartReference:
        chart: mtls-proxy
        repo: https://mesosphere.github.io/charts/stable
        version: 0.1.0
        values: |
          ---
          target: {{ required "thanos address must be set" .Values.thanosAddress }}
          certSecretName: {{ template "kommander-thanos.fullname" . }}-server-tls
          ingress:
            enabled: false
          service:
            type: LoadBalancer
            port: 443
